{% liquid
  if collection.handle == 'voyage' or collection.handle == 'scent-voyage'
    assign voyage_collection = collection
  else
    assign voyage_collection = collections['voyage']
    if voyage_collection == blank
      assign voyage_collection = collections['scent-voyage']
    endif
    if voyage_collection == blank
      assign voyage_collection = collections['all']
    endif
  endif
  
  assign voyage_products = voyage_collection.products
  
  assign categories_list = ''
  for product in voyage_products limit: 100
    assign product_type = product.type | downcase
    if categories_list == blank
      assign categories_list = product_type
    else
      unless categories_list contains product_type
        assign categories_list = categories_list | append: '|' | append: product_type
      endunless
    endif
  endfor
  assign categories_array = categories_list | split: '|'
  
  assign min_price = 0
  assign max_price = 1000
  for product in voyage_products limit: 50
    assign product_price = product.price | divided_by: 100.0
    if product_price < min_price or min_price == 0
      assign min_price = product_price
    endif
    if product_price > max_price
      assign max_price = product_price
    endif
  endfor
  
  assign destinations = 'paris|santorini|tokyo|bali|maldives|santorini'
  assign destinations_array = destinations | split: '|'
%}

{% if collection.handle == 'voyage' or collection.handle == 'scent-voyage' or collection.handle contains 'voyage' %}
<section class="az-voyage az-page-transition" data-voyage-page>
  <!-- Hero Header -->
  <div class="az-voyage__hero">
    <div class="page-width az-voyage__hero-inner">
      <div class="az-voyage__hero-content">
        {% if section.settings.eyebrow != blank %}<div class="az-voyage__eyebrow">{{ section.settings.eyebrow }}</div>{% endif %}
        {% if section.settings.title != blank %}<h1 class="az-voyage__title">{{ section.settings.title }}</h1>{% endif %}
        {% if section.settings.description != blank %}<p class="az-voyage__desc">{{ section.settings.description }}</p>{% endif %}
      </div>
    </div>
  </div>

  <!-- Explore by Destination -->
  <div class="az-voyage__destinations">
    <div class="page-width">
      <div class="az-voyage__destinations-header">
        <h2 class="az-voyage__destinations-title">Explore by Destination</h2>
        <p class="az-voyage__destinations-desc">Select a destination to discover its unique fragrance collection</p>
      </div>
      <div class="az-voyage__destinations-grid" data-voyage-destinations>
        <button class="az-voyage__destination is-active" type="button" data-destination="all">
          <div class="az-voyage__destination-image">
            <div class="az-voyage__destination-placeholder"></div>
          </div>
          <span class="az-voyage__destination-label">All</span>
        </button>
        <button class="az-voyage__destination" type="button" data-destination="paris">
          <div class="az-voyage__destination-image">
            <div class="az-voyage__destination-placeholder" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);"></div>
          </div>
          <span class="az-voyage__destination-label">Paris</span>
        </button>
        <button class="az-voyage__destination" type="button" data-destination="santorini">
          <div class="az-voyage__destination-image">
            <div class="az-voyage__destination-placeholder" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);"></div>
          </div>
          <span class="az-voyage__destination-label">Santorini</span>
        </button>
        <button class="az-voyage__destination" type="button" data-destination="tokyo">
          <div class="az-voyage__destination-image">
            <div class="az-voyage__destination-placeholder" style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);"></div>
          </div>
          <span class="az-voyage__destination-label">Tokyo</span>
        </button>
        <button class="az-voyage__destination" type="button" data-destination="bali">
          <div class="az-voyage__destination-image">
            <div class="az-voyage__destination-placeholder" style="background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);"></div>
          </div>
          <span class="az-voyage__destination-label">Bali</span>
        </button>
        <button class="az-voyage__destination" type="button" data-destination="maldives">
          <div class="az-voyage__destination-image">
            <div class="az-voyage__destination-placeholder" style="background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);"></div>
          </div>
          <span class="az-voyage__destination-label">Maldives</span>
        </button>
      </div>
    </div>
  </div>

  <div class="page-width az-voyage__container">
    <div class="az-voyage__layout">
      <!-- Filter Sidebar -->
      <aside class="az-voyage__sidebar" data-voyage-sidebar>
        <div class="az-voyage__sidebar-header">
          <h2 class="az-voyage__sidebar-title">Filters</h2>
          <button class="az-voyage__sidebar-close" type="button" data-voyage-sidebar-close aria-label="Close filters">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
              <path d="M18 6L6 18" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
              <path d="M6 6L18 18" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
            </svg>
          </button>
        </div>

        <div class="az-voyage__filters">
          <!-- Category Filter -->
          <div class="az-voyage__filter-group">
            <h3 class="az-voyage__filter-title">Category</h3>
            <div class="az-voyage__filter-options">
              <label class="az-voyage__filter-option">
                <input type="radio" name="voyage-category" value="all" data-voyage-filter="category" checked>
                <span>All Products</span>
              </label>
              {% for category in categories_array %}
                {% if category != blank %}
                  <label class="az-voyage__filter-option">
                    <input type="radio" name="voyage-category" value="{{ category | handle }}" data-voyage-filter="category">
                    <span>{{ category }}</span>
                  </label>
                {% endif %}
              {% endfor %}
            </div>
          </div>

          <!-- Price Range Filter -->
          <div class="az-voyage__filter-group">
            <h3 class="az-voyage__filter-title">Price Range</h3>
            <div class="az-voyage__price-range">
              <div class="az-voyage__price-inputs">
                <input type="number" class="az-voyage__price-input" data-voyage-price-min placeholder="{{ min_price | times: 100 | money_without_currency }}" min="0" step="0.01">
                <span>to</span>
                <input type="number" class="az-voyage__price-input" data-voyage-price-max placeholder="{{ max_price | times: 100 | money_without_currency }}" min="0" step="0.01">
              </div>
              <div class="az-voyage__price-slider">
                <input type="range" class="az-voyage__range" data-voyage-range-min min="{{ min_price | times: 100 }}" max="{{ max_price | times: 100 }}" value="{{ min_price | times: 100 }}" step="1">
                <input type="range" class="az-voyage__range" data-voyage-range-max min="{{ min_price | times: 100 }}" max="{{ max_price | times: 100 }}" value="{{ max_price | times: 100 }}" step="1">
              </div>
            </div>
          </div>

          <button type="button" class="az-voyage__reset" data-voyage-reset>Reset Filters</button>
        </div>
      </aside>

      <!-- Main Content -->
      <main class="az-voyage__main">
        <!-- Toolbar -->
        <div class="az-voyage__toolbar">
          <div class="az-voyage__results">
            <span data-voyage-destination-label></span>
            Showing <span data-voyage-count>{{ voyage_products.size }}</span> scents
          </div>
          
          <div class="az-voyage__toolbar-actions">
            <button class="az-voyage__filter-toggle" type="button" data-voyage-sidebar-toggle>
              <svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
                <path d="M3 6H21" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                <path d="M3 12H21" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                <path d="M3 18H21" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
              </svg>
              Filters
            </button>
            
            <select class="az-voyage__sort" data-voyage-sort>
              <option value="featured">Featured</option>
              <option value="price-asc">Price: Low to High</option>
              <option value="price-desc">Price: High to Low</option>
              <option value="newest">Newest</option>
            </select>
          </div>
        </div>

        <!-- Product Grid -->
        <div class="az-voyage__grid" data-voyage-grid>
          {% for product in voyage_products %}
            {% liquid
              assign type_lc = product.type | downcase
              case type_lc
                when 'diffusers'
                  assign category_token = 'diffusers'
                when 'fragrance oils'
                  assign category_token = 'fragrance-oils'
                when 'room sprays'
                  assign category_token = 'room-sprays'
                when 'candles'
                  assign category_token = 'candles'
                when 'perfumes'
                  assign category_token = 'perfumes'
                when 'discovery sets'
                  assign category_token = 'discovery-sets'
                else
                  assign category_token = type_lc | handle
              endcase
              assign on_sale = false
              if product.compare_at_price > product.price
                assign on_sale = true
              endif
              assign destination_tag = 'all'
              for tag in product.tags
                assign tag_lc = tag | downcase
                if tag_lc == 'paris' or tag_lc contains 'paris'
                  assign destination_tag = 'paris'
                  break
                elsif tag_lc == 'santorini' or tag_lc contains 'santorini'
                  assign destination_tag = 'santorini'
                  break
                elsif tag_lc == 'tokyo' or tag_lc contains 'tokyo'
                  assign destination_tag = 'tokyo'
                  break
                elsif tag_lc == 'bali' or tag_lc contains 'bali'
                  assign destination_tag = 'bali'
                  break
                elsif tag_lc == 'maldives' or tag_lc contains 'maldives'
                  assign destination_tag = 'maldives'
                  break
                endif
              endfor
            %}
            {% assign card_data_attrs = 'data-voyage-product data-category="' | append: category_token | append: '" data-destination="' | append: destination_tag | append: '" data-price="' | append: product.price | append: '" data-on-sale="' | append: on_sale | append: '"' %}
            {% render 'product-card',
              product: product,
              show_quick_add: true,
              show_wishlist: true,
              delay_index: forloop.index0 | modulo: 5 | plus: 1,
              data_attrs: card_data_attrs,
              wrapper_class: 'az-voyage__product-wrapper' %}
          {% endfor %}
        </div>

        <!-- Empty State -->
        <div class="az-voyage__empty" data-voyage-empty hidden>
          <svg width="64" height="64" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
            <path d="M12 2C8.13 2 5 5.13 5 9C5 14.25 12 22 12 22C12 22 19 14.25 19 9C19 5.13 15.87 2 12 2Z" stroke="currentColor" stroke-width="2"/>
            <path d="M12 11C13.1046 11 14 10.1046 14 9C14 7.89543 13.1046 7 12 7C10.8954 7 10 7.89543 10 9C10 10.1046 10.8954 11 12 11Z" stroke="currentColor" stroke-width="2"/>
          </svg>
          <p>No products found matching your filters.</p>
          <button type="button" class="az-voyage__reset-btn" data-voyage-reset>View All Destinations</button>
        </div>
      </main>
    </div>
  </div>

  <!-- Featured Destination Section -->
  {% if section.settings.featured_title != blank or section.settings.featured_description != blank or section.settings.featured_cta != blank or section.settings.featured_url != blank %}
  <div class="az-voyage__featured">
    <div class="az-voyage__featured-bg"></div>
    <div class="page-width az-voyage__featured-inner">
      <div class="az-voyage__featured-content">
        {% if section.settings.featured_title != blank %}<h2 class="az-voyage__featured-title">{{ section.settings.featured_title }}</h2>{% endif %}
        {% if section.settings.featured_description != blank %}<p class="az-voyage__featured-desc">{{ section.settings.featured_description }}</p>{% endif %}
        {% if section.settings.featured_cta != blank or section.settings.featured_url != blank %}<a href="{{ section.settings.featured_url | default: '#' }}" class="az-voyage__featured-btn">{{ section.settings.featured_cta | default: 'Explore' }}</a>{% endif %}
      </div>
    </div>
  </div>
  {% endif %}
</section>
{% endif %}

{% schema %}
{
  "name": "Scent Voyage",
  "tag": "section",
  "class": "section-main-scent-voyage",
  "settings": [
    {
      "type": "header",
      "content": "Hero Section"
    },
    {
      "type": "text",
      "id": "eyebrow",
      "label": "Eyebrow text",
      "default": "SCENT VOYAGE"
    },
    {
      "type": "text",
      "id": "title",
      "label": "Title",
      "default": "Scent Voyage"
    },
    {
      "type": "textarea",
      "id": "description",
      "label": "Description",
      "default": ""
    },
    {
      "type": "header",
      "content": "Featured Destination"
    },
    {
      "type": "text",
      "id": "featured_title",
      "label": "Featured title",
      "default": ""
    },
    {
      "type": "textarea",
      "id": "featured_description",
      "label": "Featured description",
      "default": ""
    },
    {
      "type": "text",
      "id": "featured_cta",
      "label": "Featured CTA text",
      "default": ""
    },
    {
      "type": "url",
      "id": "featured_url",
      "label": "Featured CTA URL"
    }
  ],
  "presets": [
    {
      "name": "Scent Voyage"
    }
  ]
}
{% endschema %}
