{% liquid
  comment
    Use the current collection when on /collections/all so products always show (no dependency on collections['all']).
  endcomment
  if collection.handle == 'all' or collection.handle == blank
    assign all_collection = collection
    if all_collection == blank
      assign all_collection = collections['all']
    endif
    if all_collection == blank
      assign all_collection = collections['frontpage']
    endif
  else
    assign all_collection = collections['all']
    if all_collection == blank
      assign all_collection = collections['frontpage']
    endif
  endif

  assign all_products = all_collection.products

  comment
    Parse ?view= from URL for hardcoded nav (new, sale, diffusers, fragrance-oils, voyage). No Admin collections needed.
  endcomment
  assign qs = request.query_string | downcase
  assign shop_view = ''
  if qs contains 'view=new'
    assign shop_view = 'new'
  elsif qs contains 'view=sale'
    assign shop_view = 'sale'
  elsif qs contains 'view=diffusers'
    assign shop_view = 'diffusers'
  elsif qs contains 'view=fragrance-oils'
    assign shop_view = 'fragrance-oils'
  elsif qs contains 'view=voyage'
    assign shop_view = 'voyage'
  elsif qs contains 'view=candles'
    assign shop_view = 'candles'
  elsif qs contains 'view=perfumes'
    assign shop_view = 'perfumes'
  endif

  assign hero_eyebrow = section.settings.eyebrow
  assign hero_title = section.settings.title
  assign hero_description = section.settings.description
  if shop_view == 'new'
    assign hero_eyebrow = '#NEW'
    assign hero_title = 'New Arrivals'
    assign hero_description = "Our newest fragrances and diffusers. Be the first to discover what's new at AROMAZUR."
  elsif shop_view == 'sale'
    assign hero_eyebrow = 'SALE'
    assign hero_title = 'Sale'
    assign hero_description = 'Special offers on select diffusers and fragrance oils. Limited-time savings.'
  elsif shop_view == 'diffusers'
    assign hero_eyebrow = 'DIFFUSERS'
    assign hero_title = 'Diffusers'
    assign hero_description = 'Elegant diffusers for every space. From compact to professional coverage.'
  elsif shop_view == 'fragrance-oils'
    assign hero_eyebrow = 'DIFFUSER OILS'
    assign hero_title = 'Fragrance Oils'
    assign hero_description = 'Premium fragrance oils for your diffuser. Hotel and Designer collections.'
  elsif shop_view == 'voyage'
    assign hero_eyebrow = 'SCENT VOYAGE'
    assign hero_title = 'Scent Voyage'
    assign hero_description = 'Destination-inspired fragrances. Explore the world through scent.'
  elsif shop_view == 'candles'
    assign hero_eyebrow = 'CANDLES'
    assign hero_title = 'Candles'
    assign hero_description = 'Scented candles for every space. Long-lasting fragrance and elegant design.'
  elsif shop_view == 'perfumes'
    assign hero_eyebrow = 'PERFUMES'
    assign hero_title = 'Perfumes'
    assign hero_description = 'Premium perfumes inspired by the French Riviera. Discover your signature scent.'
  endif

  assign categories_list = ''
  for product in all_products limit: 100
    assign product_type = product.type | downcase
    if categories_list == blank
      assign categories_list = product_type
    else
      unless categories_list contains product_type
        assign categories_list = categories_list | append: '|' | append: product_type
      endunless
    endif
  endfor
  assign categories_array = categories_list | split: '|'

  assign min_price = 0
  assign max_price = 1000
  for product in all_products limit: 50
    assign product_price = product.price | divided_by: 100.0
    if product_price < min_price or min_price == 0
      assign min_price = product_price
    endif
    if product_price > max_price
      assign max_price = product_price
    endif
  endfor
%}

{% if collection.handle == 'all' or collection.handle == blank %}
<section class="az-shop az-page-transition" data-shop-page data-shop-view="{{ shop_view }}">
  <!-- Hero Header -->
  <div class="az-shop__hero">
    <div class="page-width az-shop__hero-inner">
      <div class="az-shop__hero-content">
        {% if hero_eyebrow != blank %}<div class="az-shop__eyebrow az-fade-in az-fade-in--up az-fade-in--slow">{{ hero_eyebrow }}</div>{% endif %}
        {% if hero_title != blank %}<h1 class="az-shop__title az-fade-in az-fade-in--up az-fade-in--slow az-fade-in--delay-1">{{ hero_title }}</h1>{% endif %}
        {% if hero_description != blank %}<p class="az-shop__desc">{{ hero_description }}</p>{% endif %}
      </div>
    </div>
  </div>

  <div class="page-width az-shop__container">
    <div class="az-shop__layout">
      <!-- Filter Sidebar -->
      <aside class="az-shop__sidebar" data-shop-sidebar>
        <div class="az-shop__sidebar-header">
          <h2 class="az-shop__sidebar-title">Filters</h2>
          <button class="az-shop__sidebar-close" type="button" data-shop-sidebar-close aria-label="Close filters">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
              <path d="M18 6L6 18" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
              <path d="M6 6L18 18" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
            </svg>
          </button>
        </div>

        <div class="az-shop__filters">
          <!-- Category Filter -->
          <div class="az-shop__filter-group">
            <h3 class="az-shop__filter-title">Category</h3>
            <div class="az-shop__filter-options">
              <label class="az-shop__filter-option">
                <input type="radio" name="category" value="all" data-shop-filter="category" checked>
                <span>All Products</span>
              </label>
              {% for category in categories_array %}
                {% if category != blank %}
                  <label class="az-shop__filter-option">
                    <input type="radio" name="category" value="{{ category | handle }}" data-shop-filter="category">
                    <span>{{ category }}</span>
                  </label>
                {% endif %}
              {% endfor %}
            </div>
          </div>

          <!-- Price Range Filter -->
          <div class="az-shop__filter-group">
            <h3 class="az-shop__filter-title">Price Range</h3>
            <div class="az-shop__price-range">
              <div class="az-shop__price-inputs">
                <input type="number" class="az-shop__price-input" data-shop-price-min placeholder="{{ min_price | times: 100 | money_without_currency }}" min="0" step="0.01">
                <span>to</span>
                <input type="number" class="az-shop__price-input" data-shop-price-max placeholder="{{ max_price | times: 100 | money_without_currency }}" min="0" step="0.01">
              </div>
              <div class="az-shop__price-slider">
                <input type="range" class="az-shop__range" data-shop-range-min min="{{ min_price | times: 100 }}" max="{{ max_price | times: 100 }}" value="{{ min_price | times: 100 }}" step="1">
                <input type="range" class="az-shop__range" data-shop-range-max min="{{ min_price | times: 100 }}" max="{{ max_price | times: 100 }}" value="{{ max_price | times: 100 }}" step="1">
              </div>
            </div>
          </div>

          <button type="button" class="az-shop__reset" data-shop-reset>Reset Filters</button>
        </div>
      </aside>

      <!-- Main Content -->
      <main class="az-shop__main">
        <!-- Toolbar -->
        <div class="az-shop__toolbar">
          <div class="az-shop__results">
            Showing <span data-shop-count>{{ all_products.size }}</span> results
          </div>
          
          <div class="az-shop__toolbar-actions">
            <button class="az-shop__filter-toggle" type="button" data-shop-sidebar-toggle>
              <svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
                <path d="M3 6H21" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                <path d="M3 12H21" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                <path d="M3 18H21" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
              </svg>
              Filters
            </button>
            
            <select class="az-shop__sort" data-shop-sort>
              <option value="featured">Featured</option>
              <option value="price-asc">Price: Low to High</option>
              <option value="price-desc">Price: High to Low</option>
              <option value="newest">Newest</option>
            </select>
          </div>
        </div>

        <!-- Product Grid -->
        <div class="az-shop__grid" data-shop-grid>
          {% for product in all_products %}
            {% liquid
              assign type_lc = product.type | downcase
              case type_lc
                when 'diffusers'
                  assign category_token = 'diffusers'
                when 'fragrance oils'
                  assign category_token = 'fragrance-oils'
                when 'room sprays'
                  assign category_token = 'room-sprays'
                when 'candles'
                  assign category_token = 'candles'
                when 'perfumes'
                  assign category_token = 'perfumes'
                else
                  assign category_token = type_lc | handle
              endcase
              assign on_sale = false
              if product.compare_at_price > product.price
                assign on_sale = true
              endif
              assign is_new = false
              if product.tags contains 'new-arrivals' or product.tags contains 'new'
                assign is_new = true
              endif
              assign is_sale_tag = false
              if product.tags contains 'sale'
                assign is_sale_tag = true
              endif
              assign is_diffuser = false
              if type_lc == 'diffusers'
                assign is_diffuser = true
              endif
              assign is_oil = false
              if type_lc == 'fragrance oils'
                assign is_oil = true
              endif
              assign is_candle = false
              if type_lc == 'candles'
                assign is_candle = true
              endif
              assign is_perfume = false
              if type_lc == 'perfumes'
                assign is_perfume = true
              endif
            %}
            {% if on_sale or is_sale_tag %}{% assign show_in_sale = true %}{% else %}{% assign show_in_sale = false %}{% endif %}
            {% assign view_attrs = ' data-view-new="' | append: is_new | append: '" data-view-sale="' | append: show_in_sale | append: '" data-view-diffusers="' | append: is_diffuser | append: '" data-view-fragrance-oils="' | append: is_oil | append: '" data-view-voyage="true" data-view-candles="' | append: is_candle | append: '" data-view-perfumes="' | append: is_perfume | append: '"' %}
            {% assign card_data_attrs = 'data-shop-product data-category="' | append: category_token | append: '" data-price="' | append: product.price | append: '" data-on-sale="' | append: on_sale | append: '"' | append: view_attrs %}
            {% render 'product-card',
              product: product,
              show_quick_add: true,
              show_wishlist: true,
              delay_index: forloop.index0 | modulo: 5 | plus: 1,
              data_attrs: card_data_attrs,
              wrapper_class: 'az-shop__product-wrapper' %}
          {% endfor %}
        </div>

        <!-- Empty State -->
        <div class="az-shop__empty" data-shop-empty hidden>
          <svg width="64" height="64" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
            <path d="M4 16L10.5 9.5L14.5 13.5L20 8" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            <path d="M20 12V20H4V4H12" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
          <p>No products found matching your filters.</p>
          <button type="button" class="az-shop__reset-btn" data-shop-reset>Clear Filters</button>
        </div>
      </main>
    </div>
  </div>
</section>
{% endif %}

{% schema %}
{
  "name": "Shop All",
  "tag": "section",
  "class": "section-main-shop-all",
  "settings": [
    {
      "type": "header",
      "content": "Hero Section"
    },
    {
      "type": "text",
      "id": "eyebrow",
      "label": "Eyebrow text",
      "default": "SHOP ALL"
    },
    {
      "type": "text",
      "id": "title",
      "label": "Title",
      "default": "Shop All"
    },
    {
      "type": "textarea",
      "id": "description",
      "label": "Description",
      "default": ""
    },
    {
      "type": "image_picker",
      "id": "hero_image",
      "label": "Hero background image"
    }
  ],
  "presets": [
    {
      "name": "Shop All"
    }
  ]
}
{% endschema %}
