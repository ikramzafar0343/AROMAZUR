{% liquid
  assign source_collection = collections['all']
  if source_collection == blank
    assign source_collection = collection
  endif
%}

<section class="az-featured" id="featured" aria-labelledby="FeaturedTitle-{{ section.id }}" data-featured-products>
  <div class="page-width az-featured__container">
    <div class="az-featured__header">
      <div class="az-featured__eyebrow az-fade-in az-fade-in--up az-fade-in--slow">Featured Products</div>
      <h2 class="az-featured__title az-fade-in az-fade-in--up az-fade-in--slow az-fade-in--delay-1" id="FeaturedTitle-{{ section.id }}">Best Sellers &amp; New Arrivals</h2>
      <p class="az-featured__desc az-fade-in az-fade-in--up az-fade-in--slow az-fade-in--delay-2">Hand-picked selections of our most loved diffusers and fragrances</p>
    </div>

    <div class="az-featured__filters" role="tablist" aria-label="Product filters">
      <button class="az-filter is-active" type="button" data-filter="all" role="tab" aria-selected="true">
        <span class="az-filter__icon" aria-hidden="true">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M12 2L2 7L12 12L22 7L12 2Z" stroke="currentColor" stroke-width="2" stroke-linejoin="round"/>
            <path d="M2 17L12 22L22 17" stroke="currentColor" stroke-width="2" stroke-linejoin="round"/>
            <path d="M2 12L12 17L22 12" stroke="currentColor" stroke-width="2" stroke-linejoin="round"/>
          </svg>
        </span>
        <span>All Products</span>
      </button>

      <button class="az-filter" type="button" data-filter="diffusers" role="tab" aria-selected="false">
        <span class="az-filter__icon" aria-hidden="true">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M10 2H14" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
            <path d="M9 7C9 5.34315 10.3431 4 12 4C13.6569 4 15 5.34315 15 7V11" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
            <path d="M6 12H18L17 22H7L6 12Z" stroke="currentColor" stroke-width="2" stroke-linejoin="round"/>
          </svg>
        </span>
        <span>Diffusers</span>
      </button>

      <button class="az-filter" type="button" data-filter="fragrance-oils" role="tab" aria-selected="false">
        <span class="az-filter__icon" aria-hidden="true">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M12 2C9 6 6 9 6 13.5C6 17.0899 8.91015 20 12.5 20C16.0899 20 19 17.0899 19 13.5C19 9 16 6 13 2" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            <path d="M10 14.5C10 16.1569 11.3431 17.5 13 17.5" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
          </svg>
        </span>
        <span>Fragrance Oils</span>
      </button>

      <button class="az-filter" type="button" data-filter="room-sprays" role="tab" aria-selected="false">
        <span class="az-filter__icon" aria-hidden="true">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M10 2H14" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
            <path d="M9 6H15" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
            <path d="M8 6V22H16V6" stroke="currentColor" stroke-width="2" stroke-linejoin="round"/>
            <path d="M16 9H20V12" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
          </svg>
        </span>
        <span>Room Sprays</span>
      </button>

      <button class="az-filter" type="button" data-filter="candles" role="tab" aria-selected="false">
        <span class="az-filter__icon" aria-hidden="true">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M12 2C13.5 4 14 5.5 14 7C14 8.65685 12.6569 10 11 10C9.34315 10 8 8.65685 8 7C8 5.5 8.5 4 10 2" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            <path d="M7 12H17V22H7V12Z" stroke="currentColor" stroke-width="2"/>
          </svg>
        </span>
        <span>Candles</span>
      </button>

      <button class="az-filter" type="button" data-filter="perfumes" role="tab" aria-selected="false">
        <span class="az-filter__icon" aria-hidden="true">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M9 5C9 3.34315 10.3431 2 12 2C13.6569 2 15 3.34315 15 5V6H9V5Z" stroke="currentColor" stroke-width="2"/>
            <path d="M7 6H17V22H7V6Z" stroke="currentColor" stroke-width="2"/>
          </svg>
        </span>
        <span>Perfumes</span>
      </button>

      <button class="az-filter" type="button" data-filter="sale" role="tab" aria-selected="false">
        <span class="az-filter__icon" aria-hidden="true">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M12 2L14.2 8.2L20.8 8.2L15.4 12.1L17.6 18.2L12 14.4L6.4 18.2L8.6 12.1L3.2 8.2L9.8 8.2L12 2Z" fill="currentColor"/>
          </svg>
        </span>
        <span>On Sale</span>
      </button>
    </div>

    {% if source_collection != blank and source_collection.products_count > 0 %}
      <div class="az-featured__grid" data-featured-grid>
        {% for product in source_collection.products limit: 24 %}
          {% liquid
            assign category_token = ''

            assign type_lc = product.type | downcase
            case type_lc
              when 'diffusers'
                assign category_token = 'diffusers'
              when 'fragrance oils'
                assign category_token = 'fragrance-oils'
              when 'room sprays'
                assign category_token = 'room-sprays'
              when 'candles'
                assign category_token = 'candles'
              when 'perfumes'
                assign category_token = 'perfumes'
            endcase

            if category_token == blank
              for tag in product.tags
                assign tag_lc = tag | downcase
                if tag_lc == 'diffusers'
                  assign category_token = 'diffusers'
                  break
                elsif tag_lc == 'fragrance oils'
                  assign category_token = 'fragrance-oils'
                  break
                elsif tag_lc == 'room sprays'
                  assign category_token = 'room-sprays'
                  break
                elsif tag_lc == 'candles'
                  assign category_token = 'candles'
                  break
                elsif tag_lc == 'perfumes'
                  assign category_token = 'perfumes'
                  break
                endif
              endfor
            endif

            assign on_sale = false
            if product.compare_at_price_max > product.price
              assign on_sale = true
            endif
          %}

          {% assign delay_index = forloop.index0 | modulo: 5 | plus: 1 %}
          <div class="az-prod az-fade-in az-fade-in--up az-fade-in--delay-{{ delay_index }}" data-category="{{ category_token | escape }}" data-onsale="{% if on_sale %}true{% else %}false{% endif %}">
            <a class="az-prod__link" href="{{ product.url }}">
              <div class="az-prod__media">
                {% if product.featured_image %}
                  {{ product.featured_image | image_url: width: 700 | image_tag: loading: 'lazy', decoding: 'async', alt: product.title }}
                {% else %}
                  <div class="az-prod__placeholder"></div>
                {% endif %}
                {% if on_sale %}
                  <span class="az-prod__badge">SALE</span>
                {% endif %}
              </div>
              <div class="az-prod__body">
                <h3 class="az-prod__title">{{ product.title }}</h3>
                <div class="az-prod__price">
                  <span class="az-prod__price-current">{{ product.price | money }}</span>
                  {% if on_sale %}
                    <span class="az-prod__price-compare">{{ product.compare_at_price_max | money }}</span>
                  {% endif %}
                </div>
              </div>
            </a>

            <div class="az-prod__actions">
              {% form 'product', product, class: 'az-prod__form' %}
                <input type="hidden" name="id" value="{{ product.selected_or_first_available_variant.id }}">
                <button class="az-prod__btn" type="submit" {% unless product.selected_or_first_available_variant.available %}disabled{% endunless %}>
                  {% if product.selected_or_first_available_variant.available %}Add to cart{% else %}Sold out{% endif %}
                </button>
              {% endform %}
            </div>
          </div>
        {% endfor %}
      </div>

      <div class="az-featured__empty" data-featured-empty hidden>
        <p>No products found in this category.</p>
      </div>

      <div class="az-featured__cta">
        <a class="az-featured__viewall" href="{{ routes.all_products_collection_url }}">View All Products</a>
      </div>
    {% else %}
      <div class="az-featured__empty">
        <p>No products found.</p>
      </div>
    {% endif %}
  </div>
</section>

{% schema %}
{
  "name": "Home featured products",
  "tag": "section",
  "class": "section-home-featured-products",
  "settings": [],
  "presets": [
    {
      "name": "Home featured products"
    }
  ]
}
{% endschema %}
